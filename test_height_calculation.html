<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combobox Height Calculation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .test-button {
            background: #007F8C;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        .test-button:hover {
            background: #016974;
        }

        .results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .mock-combobox {
            position: relative;
            width: 100%;
            margin: 10px 0;
        }

        .mock-trigger {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: white;
            cursor: pointer;
        }

        .mock-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            margin-top: 2px;
        }

        .mock-search {
            padding: 10px;
            border: none;
            border-bottom: 1px solid #eee;
            width: 100%;
            outline: none;
        }

        .mock-scroll-area {
            max-height: 200px;
            overflow-y: auto;
        }

        .mock-option {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .mock-option:hover {
            background: #f5f5f5;
        }

        .mock-option:last-child {
            border-bottom: none;
        }

        .position-controls {
            margin: 20px 0;
        }

        .position-controls label {
            display: inline-block;
            width: 150px;
            margin-right: 10px;
        }

        .position-controls input {
            width: 100px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Combobox Height Calculation Test</h1>
        <p>This page tests the height calculation logic for maintaining a 50px margin at the bottom of the viewport.</p>

        <div class="test-section">
            <h2>Test Controls</h2>
            <button class="test-button" onclick="runHeightCalculationTest()">Run Height Calculation Test</button>
            <button class="test-button" onclick="simulateSmallViewport()">Simulate Small Viewport</button>
            <button class="test-button" onclick="simulateLargeViewport()">Simulate Large Viewport</button>
            <button class="test-button" onclick="clearResults()">Clear Results</button>
        </div>

        <div class="test-section">
            <h2>Position Controls</h2>
            <div class="position-controls">
                <label>Dropdown Top Position:</label>
                <input type="number" id="dropdownTop" value="300" min="0" max="800">
                <span>px from top of viewport</span>
            </div>
            <div class="position-controls">
                <label>Content Height:</label>
                <input type="number" id="contentHeight" value="400" min="100" max="1000">
                <span>px</span>
            </div>
            <div class="position-controls">
                <label>Viewport Height:</label>
                <input type="number" id="viewportHeight" value="600" min="300" max="1200">
                <span>px</span>
            </div>
        </div>

        <div class="test-section">
            <h2>Mock Combobox</h2>
            <div class="mock-combobox" id="mockCombobox">
                <div class="mock-trigger" onclick="toggleMockDropdown()">
                    Click to open dropdown (for visual testing)
                </div>
                <div class="mock-dropdown" id="mockDropdown" style="display: none;">
                    <input class="mock-search" placeholder="Search..." />
                    <div class="mock-scroll-area" id="mockScrollArea">
                        <!-- Generate many options for testing -->
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Test Results</h2>
            <div class="results" id="results">Click "Run Height Calculation Test" to see results...</div>
        </div>
    </div>

    <script>
        // Height calculation logic (extracted from the SearchCombobox)
        function calculateOptimalHeight(dropdownTop, viewportHeight, contentHeight) {
            console.log(`Height calculation - viewport: ${viewportHeight}px, dropdown top: ${dropdownTop}px`);

            // Calculate available space below the dropdown (accounting for 50px margin)
            const availableHeight = viewportHeight - dropdownTop - 50;

            console.log(`Available height: ${availableHeight}px, content height: ${contentHeight}px`);

            // Add space for search input and padding (approximately 60px)
            const searchInputHeight = 60;
            const maxContentHeight = Math.max(100, availableHeight - searchInputHeight);

            let result = {
                viewportHeight,
                dropdownTop,
                contentHeight,
                availableHeight,
                searchInputHeight,
                maxContentHeight,
                needsConstraint: contentHeight > maxContentHeight,
                calculatedHeight: null,
                calculatedHeightRem: null
            };

            // Only set height if we need to constrain it
            if (contentHeight > maxContentHeight) {
                const heightInRem = maxContentHeight / 16; // Convert px to rem (assuming 16px = 1rem)
                result.calculatedHeight = maxContentHeight;
                result.calculatedHeightRem = heightInRem;
                console.log(`Set dropdown height to ${heightInRem}rem (${maxContentHeight}px) to maintain 50px bottom margin`);
            } else {
                console.log('Using default height as content fits within viewport');
            }

            return result;
        }

        function runHeightCalculationTest() {
            const dropdownTop = parseInt(document.getElementById('dropdownTop').value);
            const contentHeight = parseInt(document.getElementById('contentHeight').value);
            const viewportHeight = parseInt(document.getElementById('viewportHeight').value);

            const result = calculateOptimalHeight(dropdownTop, viewportHeight, contentHeight);

            let output = `Height Calculation Test Results:\n`;
            output += `=====================================\n`;
            output += `Viewport Height: ${result.viewportHeight}px\n`;
            output += `Dropdown Top Position: ${result.dropdownTop}px\n`;
            output += `Content Height: ${result.contentHeight}px\n`;
            output += `Available Height (with 50px margin): ${result.availableHeight}px\n`;
            output += `Search Input Height: ${result.searchInputHeight}px\n`;
            output += `Max Content Height: ${result.maxContentHeight}px\n`;
            output += `Needs Height Constraint: ${result.needsConstraint}\n`;

            if (result.needsConstraint) {
                output += `Calculated Height: ${result.calculatedHeight}px (${result.calculatedHeightRem.toFixed(2)}rem)\n`;
                output += `Bottom Margin Maintained: ${viewportHeight - dropdownTop - result.calculatedHeight - result.searchInputHeight}px\n`;
            } else {
                output += `Using Default Height: Content fits within available space\n`;
                output += `Bottom Margin: ${viewportHeight - dropdownTop - result.contentHeight - result.searchInputHeight}px\n`;
            }

            // Update mock dropdown for visual verification
            updateMockDropdown(result);

            document.getElementById('results').textContent = output;
        }

        function updateMockDropdown(result) {
            const mockScrollArea = document.getElementById('mockScrollArea');
            const mockCombobox = document.getElementById('mockCombobox');

            // Position the mock combobox
            mockCombobox.style.marginTop = `${result.dropdownTop - 100}px`;

            // Set the height of the scroll area
            if (result.needsConstraint) {
                mockScrollArea.style.maxHeight = `${result.calculatedHeight}px`;
            } else {
                mockScrollArea.style.maxHeight = `${result.contentHeight}px`;
            }

            // Generate options to fill the content height
            const optionHeight = 32; // Approximate height per option
            const numOptions = Math.ceil(result.contentHeight / optionHeight);

            let optionsHtml = '';
            for (let i = 1; i <= numOptions; i++) {
                optionsHtml += `<div class="mock-option">Option ${i}</div>`;
            }
            mockScrollArea.innerHTML = optionsHtml;
        }

        function simulateSmallViewport() {
            document.getElementById('viewportHeight').value = '400';
            document.getElementById('dropdownTop').value = '250';
            document.getElementById('contentHeight').value = '300';
            runHeightCalculationTest();
        }

        function simulateLargeViewport() {
            document.getElementById('viewportHeight').value = '1000';
            document.getElementById('dropdownTop').value = '200';
            document.getElementById('contentHeight').value = '600';
            runHeightCalculationTest();
        }

        function toggleMockDropdown() {
            const dropdown = document.getElementById('mockDropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function clearResults() {
            document.getElementById('results').textContent = 'Click "Run Height Calculation Test" to see results...';
        }

        // Initialize with default test
        window.onload = function() {
            runHeightCalculationTest();
        };
    </script>
</body>
</html>
